<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ðŸŽ¥ Django Video Player</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: black;
            overflow: hidden;
        }

        video {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            background: black;
        }

        h2, p {
            display: none;
        }
    </style>
</head>
<body>
<video id="player" controls>
    <source id="videoSource" src="" type="video/mp4">
    Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð²Ð¸Ð´ÐµÐ¾.
</video>

<script>
    const player = document.getElementById("player");
    const videoSource = document.getElementById("videoSource");

    // ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ðº SSE ÑÐµÑ€Ð²ÐµÑ€Ñƒ
    const evtSource = new EventSource("http://192.168.19.13:8000/sse/host?param=DJANGO");

    // --- ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ñ ---
    evtSource.addEventListener("play", (event) => {
        console.log(event.data)
        const payload = JSON.parse(event.data);
        const url = payload.urls[0].url;
        videoSource.src = url;
        player.load();
        player.play();
    });

    evtSource.addEventListener("pause", () => player.pause());
    evtSource.addEventListener("setvol", (event) => {
        const payload = JSON.parse(event.data);
        player.volume = payload.volume;
    });
    evtSource.addEventListener("stop", () => {
        player.pause();
        player.currentTime = 0;
    });
    evtSource.addEventListener("replay", () => {
        player.currentTime = 0;
        player.play();
    });
</script>
</body>
</html>
